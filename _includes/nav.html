<!-- Navigation -->
<nav class="site-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <div class="nav-container">
        <!-- 移动端菜单开关 -->
        <div class="mobile-menu">
            <button class="hamburger" aria-label="菜单开关" aria-expanded="false">
                <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                </span>
            </button>
            <a class="nav-brand" href="{{ site.baseurl }}/" itemprop="url">
                <span itemprop="name">{{ site.title }}</span>
            </a>
        </div>

        <!-- 导航菜单 -->
        <div class="nav-menu" id="nav-menu">
            <ul class="nav-list" role="menubar">
                <li role="none">
                    <a href="{{ site.baseurl }}/" role="menuitem" itemprop="url">首页</a>
                </li>
                {% for page in site.pages %}{% if page.title %}
                <li role="none" itemprop="name">
                    <a href="{{ page.url | prepend: site.baseurl }}" role="menuitem" itemprop="url">{{ page.title }}</a>
                </li>
                {% endif %}{% endfor %}
            </ul>
        </div>
    </div>
</nav>

<style>
/* ================== 安全修复版本 ================== */
:root {
    --nav-bg: rgba(42,92,170,0.98);
    --nav-text: #ffffff;
    --nav-accent: #5BC0EB;
}

/* 修复1：安全定位系统 */
.site-nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
    background: var(--nav-bg);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    max-width: 100vw; /* 新增安全限制 */
}

/* 修复2：容器溢出保护 */
.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
    box-sizing: border-box;
    overflow: visible;
}

/* 修复3：弹性布局安全模式 */
.nav-list {
    display: flex;
    gap: 2rem;
    list-style: none;
    margin: 0;
    padding: 0;
    flex-wrap: wrap; /* 新增安全换行 */
}

/* 修复4：移动端响应式强化 */
@media (max-width: 768px) {
    .nav-menu {
        width: 100vw;
        left: 0;
        right: 0;
        box-shadow: 0 2px 15px rgba(0,0,0,0.2);
        overscroll-behavior: contain; /* 防止滚动穿透 */
    }

    .nav-list a {
        white-space: normal;
        word-break: break-word;
        padding: 1rem;
        display: block;
    }

    .hamburger {
        margin-right: -0.5rem; /* 对齐补偿 */
        touch-action: manipulation; /* 优化移动点击 */
    }
}

/* 保留原有动画效果 */
.nav-list a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--nav-accent);
    transition: width 0.3s ease;
}
</style>

<script>
// 安全增强版脚本
document.addEventListener('DOMContentLoaded', () => {
    const hamburger = document.querySelector('.hamburger');
    const navMenu = document.querySelector('#nav-menu');
    let isMenuOpen = false;

    // 菜单切换
    const toggleMenu = (state) => {
        isMenuOpen = state ?? !isMenuOpen;
        hamburger.classList.toggle('active', isMenuOpen);
        navMenu.classList.toggle('active', isMenuOpen);
        hamburger.setAttribute('aria-expanded', isMenuOpen);
        document.documentElement.style.overflowY = isMenuOpen ? 'hidden' : '';
    };

    // 点击处理
    hamburger.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMenu();
    });

    // 外部点击关闭
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.site-nav')) toggleMenu(false);
    });

    // 安全滚动处理
    let lastScroll = 0;
    const handleScroll = () => {
        const currentScroll = window.scrollY;
        const shouldHide = currentScroll > lastScroll && currentScroll > 100;
        
        requestAnimationFrame(() => {
            document.documentElement.style.setProperty(
                '--nav-translate', 
                shouldHide ? '-100%' : '0'
            );
        });
        
        lastScroll = currentScroll;
    };

    // 优化滚动性能
    window.addEventListener('scroll', handleScroll, { passive: true });

    // 响应式清理
    window.matchMedia('(min-width: 769px)').addListener((mq) => {
        if (mq.matches) toggleMenu(false);
    });
});
</script>