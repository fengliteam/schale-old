<!DOCTYPE html>
<html lang="zh-CN" itemscope itemtype="http://schema.org/WebSite">

{% include head.html %}

<style>
:root {
    --primary: #2A5CAA;
    --accent: #5BC0EB;
    --text: #2C3E50;
}

/* 布局稳定性增强 */
body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    line-height: 1.7;
    color: var(--text);
    scroll-behavior: smooth;
}

/* 防布局偏移规则 */
img, video, iframe {
    max-width: 100%;
    height: auto;
    aspect-ratio: attr(width) / attr(height);
}

.navbar {
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.nav-item {
    transition: transform 0.3s ease;
}

.nav-item:hover {
    transform: translateY(-2px);
}

.footer {
    background: rgba(16,33,54,0.95);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(91,192,235,0.3);
}

@media (max-width: 768px) {
    .navbar-collapse {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(10px);
    }
}
</style>

<body>
    <!-- 结构化数据 -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "沙勒避难所-S.C.H.A.L.E.",
        "url": "https://schale.us.kg",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://schale.us.kg/search?q={search_term}",
            "query-input": "required name=search_term"
        }
    }
    </script>

    {% include nav.html %}

    <main role="main">
        <!-- 图片使用示例 -->
        <picture>
            <source srcset="image.webp" type="image/webp">
            <img src="image.jpg" 
                 alt="示例图片"
                 width="800"
                 height="600"
                 loading="lazy">
        </picture>
        
        {{ content }}
    </main>

    {% include footer.html %}

    <!-- 优化后的全局脚本 -->
    <script>
    // 平滑滚动优化版
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const targetTop = target.getBoundingClientRect().top + window.pageYOffset;
                window.scrollTo({
                    top: targetTop - 20, // 留出导航栏空间
                    behavior: 'smooth'
                });
            }
        });
    });

    // 被动事件监听器
    document.addEventListener('touchstart', function(){}, {
        passive: true,
        capture: true
    });

    // 布局稳定性增强
    window.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('img').forEach(img => {
            if (!img.hasAttribute('width') || !img.hasAttribute('height')) {
                img.style.aspectRatio = '16 / 9'; // 默认比例
            }
        });
    });
    </script>

    <!-- 智能图片加载系统 -->
    <script defer>
    window.addEventListener('load', () => {
        // 渐进式图片加载
        const lazyImages = document.querySelectorAll('img[loading="lazy"]');
        lazyImages.forEach(img => {
            img.src = img.dataset.src;
            img.removeAttribute('data-src');
        });

        // 首屏图片预加载
        const criticalImages = document.querySelectorAll('img[loading="eager"]');
        criticalImages.forEach(img => {
            new Image().src = img.src;
        });
    });
    </script>
</body>
</html>