<!DOCTYPE html>
<html lang="zh-CN" itemscope itemtype="http://schema.org/WebPage" class="no-js">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#2A5CAA">
    
    <!-- 核心SEO优化 -->
    <title itemprop="name">{{ page.title }} | 沙勒避难所-S.C.H.A.L.E.</title>
    <meta name="description" content="{{ page.description | default: '基沃托斯最全面的学生资料库与攻略整合平台' }}">
    <link rel="canonical" href="https://schale.us.kg{{ page.url }}">
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="/assets/css/main.min.css" as="style">
    <link rel="preload" href="/fonts/inter.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preconnect" href="https://cdn.us.kg">
    
    <!-- 社交元数据 -->
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="沙勒避难所-S.C.H.A.L.E.">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- 结构化数据 -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "沙勒避难所-S.C.H.A.L.E.",
        "url": "https://schale.us.kg",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://schale.us.kg/search?q={search_term}",
            "query-input": "required name=search_term"
        },
        "author": {
            "@type": "Organization",
            "name": "沙勒学院",
            "logo": {
                "@type": "ImageObject",
                "url": "https://schale.us.kg/logo.webp",
                "width": 600,
                "height": 600
            }
        }
    }
    </script>

    <!-- 内联关键CSS -->
    <style>
    :root{--primary:#2A5CAA;--accent:#5BC0EB;--text:#2C3E50}
    html{scroll-behavior:smooth;scroll-padding-top:80px}
    .js .loading{opacity:0;transition:opacity .3s}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,sans-serif;line-height:1.7;color:var(--text);margin:0}
    .lazyload,.lazyloading{opacity:0}
    .lazyloaded{opacity:1;transition:opacity .3s}
    [data-src]{background:#f3f4f6}
    .navbar{background:linear-gradient(135deg,var(--primary) 0%,var(--accent) 100%);box-shadow:0 2px 10px rgba(0,0,0,0.1);position:sticky;top:0;z-index:1000}
    .nav-item{transition:transform .3s ease}
    .nav-item:hover{transform:translateY(-2px)}
    @media(max-width:768px){.navbar-collapse{background:rgba(255,255,255,0.95);backdrop-filter:blur(10px)}}
    </style>
    
    <!-- 异步加载非关键CSS -->
    <link rel="stylesheet" href="/assets/css/main.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="/assets/css/main.min.css"></noscript>
</head>

<body ontouchstart="" class="loading">
    <!-- 面包屑导航 -->
    <nav aria-label="面包屑导航" class="breadcrumb">
        <ol itemscope itemtype="https://schema.org/BreadcrumbList">
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <a href="/" itemprop="item"><span itemprop="name">首页</span></a>
                <meta itemprop="position" content="1">
            </li>
            {% if page.breadcrumb %}
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <a href="{{ page.url }}" itemprop="item"><span itemprop="name">{{ page.title }}</span></a>
                <meta itemprop="position" content="2">
            </li>
            {% endif %}
        </ol>
    </nav>

    <main role="main" id="main-content" class="content-area">
        {{ content }}
        
        <!-- 内容分页 -->
        {% if paginator.total_pages > 1 %}
        <nav aria-label="分页导航">
            <ul class="pagination">
                {% if paginator.previous_page %}
                <li><a href="{{ paginator.previous_page_path }}" rel="prev" aria-label="上一页">«</a></li>
                {% endif %}
                <li><span>第 {{ paginator.page }} 页，共 {{ paginator.total_pages }} 页</span></li>
                {% if paginator.next_page %}
                <li><a href="{{ paginator.next_page_path }}" rel="next" aria-label="下一页">»</a></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </main>

    <!-- 渐进增强脚本 -->
    <script>
    // 初始状态处理
    document.documentElement.classList.remove('no-js');
    window.addEventListener('DOMContentLoaded', function() {
        document.body.classList.remove('loading');
    });

    // 图片延迟加载系统
    const lazyLoad = (entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.classList.add('lazyloaded');
                observer.unobserve(img);
            }
        });
    };

    // 交互优化
    const initInteractive = () => {
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) target.scrollIntoView({behavior: 'smooth', block: 'start'});
            });
        });

        // 触控反馈
        document.addEventListener('touchstart', function(e) {
            if (e.target.closest('a, button')) {
                e.target.classList.add('active');
                setTimeout(() => e.target.classList.remove('active'), 150);
            }
        }, {passive: true});

        // 延迟加载初始化
        const observer = new IntersectionObserver(lazyLoad, {
            rootMargin: '200px 0px',
            threshold: 0.01
        });
        document.querySelectorAll('[data-src]').forEach(img => observer.observe(img));
    };

    // 加载优先级控制
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initInteractive);
    } else {
        initInteractive();
    }
    </script>

    <!-- 异步加载非关键资源 -->
    <script defer src="/assets/js/analytics.min.js"></script>
    <script defer src="https://cdn.us.kg/static/email-decode.min.js"></script>

    <!-- 性能监控 -->
    <script>
    window.__CLS = [];
    new PerformanceObserver(list => {
        for (const entry of list.getEntries()) {
            if (!entry.hadRecentInput) {
                window.__CLS.push(entry.value);
            }
        }
    }).observe({type: 'layout-shift', buffered: true});
    </script>

    {% include footer.html %}
</body>
</html>